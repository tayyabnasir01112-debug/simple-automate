services:
  - type: web
    name: simpleautomate-api
    env: node
    plan: starter
    region: oregon
    branch: main
    repo: https://github.com/tayyabnasir01112-debug/simple-automate
    buildCommand: cd server && npm install && npm run build
    startCommand: cd server && npm run start
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: FRONTEND_URLS
        sync: false
      - key: APP_BASE_URL
        sync: false
      - key: JWT_ACCESS_SECRET
        sync: false
      - key: JWT_REFRESH_SECRET
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_PRICE_ID
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: RESEND_API_KEY
        sync: false
      - key: EMAIL_FROM
        value: "SimpleAutomate <hello@simpleautomate.co.uk>"
      - key: CRON_SECRET
        sync: false
      - key: TRIAL_DAYS
        value: "7"
  - type: cron
    name: simpleautomate-automation-cron
    env: node
    plan: starter
    schedule: "*/15 * * * *"
    repo: https://github.com/tayyabnasir01112-debug/simple-automate
    branch: main
    buildCommand: ""
    startCommand: >
      bash -lc "curl -X POST \"$API_BASE_URL/api/cron/run\" -H 'Content-Type: application/json' -d '{\"secret\":\"'$CRON_SECRET'\"}'"
    envVars:
      - key: API_BASE_URL
        sync: false
      - key: CRON_SECRET
        sync: false

